<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<!--<link rel="stylesheet" href="css/theme/black.css">-->
        <link rel="stylesheet" href="css/theme/night.css" id="theme">
        <link rel="stylesheet" href="css/main.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
                <section>
                    <h3>Fun with robotics using Perl and LEGO® Mindstorms</h3>
                    <aside class="notes">
                        Don't forget your laser pointer
                    </aside>
                </section>

                <section data-state="dragonlance">
                    <img src="images/dragonlance_chronicles_legends.jpg">
                    <h4>Story Time</h4>
                    <small>Growing up with Fantasy and Magic</small>
                    <aside class="notes">
                        DragonLance - Chronicles 1 and adventurers new beginnings<br><br>
                        Worlds full of fantastic ideas, like wizardry
                    </aside>
                </section>

                <section>
                    <h4>Why the Story?</h4>
                    <aside class="notes">
                        Coding with Robots is Wizardry<br><br>
                        This trying to do something more with Mindstorms outside of the normal bounds is our new adventure and as youw will see, as with many new adventuers,
                        you can easily find yourself taking the the more complicated path first until you know you way better.
                    </aside>
                </section>

                <section>
                    <h4>What are we doing?</h4>
                    Using a text-based language (Perl) to control Mindstorms with a reasonable degree of usability.
                </section>

                <section>
                    <img src="images/laptop.jpg" width="60%">
                    <h4>But first...</h4>
                </section>

                <section data-state="ev3visualloop">
                    <img src="images/ev3visualloop.png">
                    Scripts built with sequence of blocks.
                </section>

                <section data-state="ev3brick">
                    <img src="images/ev3brick.jpg" width="45%"><br>
                    Released in September 2013
                </section>

                <section>
                    <p>178×128 pixel Monochrome LCD</p>
                    <p>TI Sitara AM1808 (ARM926EJ-S core) @300 MHz Processor</p>
                    <p>64 MB RAM</p>
                    <p>16 MB Flash</p>
                    <p>USB Port</p>
                    <p>SD Card Slot</p>
                </section>

                <section>
                    <h4>Mindstorms with Perl</h4>
                    Looking for our solution...
                </section>

                <section>A lot of <strike>other great solutions</strike> not perl...
                    <p class="fragment"><a href="http://legoengineering.com/platform/labview/" target="_blank">LabVIEW</a> - not Perl</p>
                    <p class="fragment"><a href="http://www.lejos.org/ev3.php" target="_blank">leJOS</a> - not Perl</p>
                    <p class="fragment"><a href="http://www.legoengineering.com/open-roberta/" target="_blank">OpenRoberta</a> - not Perl</p>
                    <p class="fragment"><a href="http://www.legoengineering.com/introducing-ev3-basic/" target="_blank">EV3 Basic</a> - not Perl</p>
                    <aside class="notes">
                        http://www.legoengineering.com/alternative-programming-languages/
                    </aside>
                </section>

                <section>
                    <p class="fragment"><a href="https://scratch.mit.edu/" target="_blank">Scratch</a> - not Perl</p>
                    <p class="fragment"><a href="http://www.legoengineering.com/platform/robolab/" target="_blank">ROBOLAB</a> - not Perl</p>
                    <p class="fragment"><a href="http://www.robotc.net/" target="_blank">RobotC</a> - not Perl. <br><small>Though there is RobotC::Wrapper</small></p>
                </section>

                <section>
                    <h4><a href="http://www.ev3dev.org/" target="_blank">EV3Dev</a></h4>
                    <p>Debian based Linux Distro</p>
                    <p>Boots off the SD Card</p>
                </section>

                <section>
                    <img src="images/ev3boot.jpg" width="50%"><br>
                    <p>We can run whatever language runs on Linux so we have the first part of our solution!</p>
                </section>

                <section data-state="langsev3dev">
                    <img src="images/Programming_Languages_on_ev3dev.png" width="80%">
                </section> 

                <section>
                    <h4>No Perl but...</h4>
                    <p class="fragment">ev3dev-c comes with a Perl module generate with SWIG!</p>
                </section>

                <section>
                    <h4><a href="http://www.swig.org/" target="_blank">SWIG?</a></h4>
                    <p>Simplified Wrapper and Interface Generator</p>
                </section>

                <section>
                    <p>XS = Perl engineers solution for interacting with C</p>
                    <p>SWIG = C engineers solution for interaction with <strike>other languages</strike> Perl</p>
                </section>

                <section>
                    <h4>Basically...</h4>
                    <p>You create .i file the represents the mapping of C to Perl (variables, functions, structs, classes,etc)</p>
                </section>

                <section>
                    <h4>Then...</h4>
                    <p>SWIG generates a shared object file (.so) and a Perl module (.pm)</p>
                </section>

                <section data-state="ev3devcperl">
                    <img src="images/ev3devcperl.png">
                    <p>Thanks <a href="https://github.com/in4lio/ev3dev-c" target="_blank">ev3dev-c</a></p>
                </section>

                <section>
                    <h4>Further Challenge...</h4>
                    The EV3 brick isn't the most performant
                    <p class="fragment">So coding in a session on the EV3 Brick isn't ideal</p>
                </section>
    
                <section>
                    <p>TI Sitara AM1808 (ARM926EJ-S core) @300 MHz Processor</p>
                    <p>64 MB RAM</p>
                    <p>16 MB Flash</p>
                    <aside class="notes">
                     http://www.ti.com/lit/er/sprz313h/sprz313h.pdf - Processor has beend around at least since 2010
                    </aside>
                </section>

                <section data-state="docker">
                    <img src="images/docker.jpg">
                    <h4><a href="https://hub.docker.com/search/?q=ev3dev" target="_blank">Docker!</a></h4>
                </section>

                <section>
                    <a href="https://github.com/gaudeon/ev3dev-perl" target="_blank">The Project</a>
                    <pre><code data-trim data-noescape class="bash">
                        lib/
                            ev3.pm
                            ev3.so
                            server.pm
                        t/
                            lib/
                                ev3mock.pm
                            server.t 
                    </code></pre>
                </section>

                <section data-state="ev3devcexamples">
                    <img src="images/ev3devcexamples.png" width="50%">
                    <h4><a href="http://in4lio.github.io/ev3dev-c/" target="_blank">Helpful Docs / Examples</a></h4>
                </section>

                <section data-state="ev3devcperlexamples">
                    <img src="images/ev3devcperlexamples.png">
                    There are Perl Examples!
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        #!/usr/bin/env perl

                        use strict;
                        use warnings;

                        ev3::ev3_init() != -1 || die 'failed to initialized ev3';

                        while ( ev3::ev3_tacho_init() < 1 ) {
                            sleep 1;
                        }

                        my ( $ok, $sn ) = ev3::ev3_search_tacho( 
                            $ev3::LEGO_EV3_L_MOTOR
                        );

                        if ($ok ) {
                            my $speed = 500;
                            ev3::set_tacho_speed_sp( $sn, $speed );

                            ev3::set_tacho_ramp_up_sp( $sn, 0 );
                            ev3::set_tacho_ramp_down_sp( $sn, 0 );

                            ev3::set_tacho_command_inx( 
                                $sn, $ev3::TACHO_RUN_FOREVER 
                            );
                        }

                        ev3::ev3_unint();
                    </code></pre>
                    Motor Movement
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        ev3::ev3_init() != -1 || die 'failed to initialized ev3';

                        while ( ev3::ev3_tacho_init() < 1 ) {
                            sleep 1;
                        }
                    </code></pre>
                    Motor Movement - Initialization
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        my ( $ok, $sn ) = ev3::ev3_search_tacho( 
                            $ev3::LEGO_EV3_M_MOTOR 
                        );
                    </code></pre>
                    Motor Movement - Finding our Motor
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        my $speed = 500;
                        ev3::set_tacho_speed_sp( $sn, $speed );

                        ev3::set_tacho_ramp_up_sp( $sn, 0 );
                        ev3::set_tacho_ramp_down_sp( $sn, 0 );

                        ev3::set_tacho_command_inx( 
                            $sn, $ev3::TACHO_RUN_FOREVER
                        );
                    </code></pre>
                    Motor Movement - Moving our Motor
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        ev3::ev3_unint();
                    </code></pre>
                    Motor Movement - Uninitialization
                </section>

                <section data-state="ev3devlangsupporttip">
                    <img src="images/ev3devlangsupporttip.png"><br>
                    In hindsight, this path I adventured down was likely a more difficult one...
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        #!/usr/bin/env perl

                        use strict;
                        use warnings;

                        use File::Spec;

                        my $tacho_sys_dir = $ev3::TACHO_DIR;

                        my ( $ok, $sn ) = ev3::ev3_search_tacho(
                            $ev3::LEGO_EV3_L_MOTOR
                        );

                        my $max_speed_file = File::Spec->catfile(
                            $tacho_sys_dir, 
                            "motor$sn", 
                            'max_speed'
                        );

                        open my $fh, 
                                '&lt;', 
                                $max_speed_file || die "Could not open $max_speed_file $1";

                        my @lines = <$fh>;

                        close $fh;

                        my $data = join "\n", @lines;
                        chomp $data;

                        print "My max speed is: $data\n";
                    </code></pre>
                    SysFS among other things...
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        my $tacho_sys_dir = $ev3::TACHO_DIR;
                    </code></pre>
                </section>

                <section>
                    <pre><code data-trim data-noescape class="perl">
                        my $max_speed_file = File::Spec->catfile(
                            $tacho_sys_dir,
                            "motor$sn",
                            'max_speed'
                        );

                        open my $fh,
                                '&lt;',
                                $max_speed_file || die "Could not open $max_speed_file $1";

                        my @lines = <$fh>;

                        close $fh;
                    </code></pre>
                </section>

                <section>
                    <h4>Demo Time!</h4>
                </section>

                <section data-state="lucy">
                    <img src="images/lucy.jpg" width="30%"><br>
                    Helpful Advice
                </section>

                <section>
                    <pre><code class="bash">sudo apt-get install cpanminus</code></pre>
                </section>

                <section>
                    <p>"Can't locate loadable object for module ev"</p><br>
                    <p>Likely means code isn't being run on ev3dev or docker container</p>
                </section>

                <section>
                    <p>Battery power matters.</p><br>
                    <p>Low power and your OS gets <strong>really</strong> sluggish</p>
                </section>

                <section>
                    <p>Don't forget to run your scripts as root!</p>
                </section>

                <section>
                    What about Perl 6? <span class="fragment">:(</span>
                </section>

                <section>
                    <img src="images/brickpi3.jpg" width="60%">
                    <h4>Next Adventure?</h4>
                </section>

                <section>
                    <p>EV3Dev for BrickPi</p>
                    <p>Raspian for Robots</p>
                </section>

                <section>
                    <img src="images/brokensd.jpg" width="60%">
                </section>

                <section>
                    Dexter Industries has great support!

                    <aside class="notes">
                        John Cole
                    </aside>
                </section>

                <section>
                    <a href="https://github.com/DexterInd/BrickPi3/tree/master/Firmware">Updating firmware</a>
                </section>

                <section>
                    <h4>Coding on Raspbian For Robots</h4>

                    There is a <a href="https://github.com/DexterInd/BrickPi3/tree/master/Software/C" target="_blank">C lib</a> on Rasbian for Robots but no SWIG for perl. Building a SWIG to Perl implementation is an interesting experience but...
                </section>

                <section>
                    <h4>Coding on Raspbian For Robots cont.</h4>

                    Interacting with the BrickPi directly can happen by sending some bytes over SPI.
                    And there is even a Perl Module, <a href="https://metacpan.org/pod/RPi::SPI">RPi::SPI</a>,  to help you.
                </section>

                <section>
                    <h4>Perl 6?</h4>
                    <p>Instead of SWIG you could try <a href="https://docs.perl6.org/language/nativecall" target="_blank">NativeCall</a> to use the C lib in Perl 6 or...</p>
                </section>

                <section>
                    <h4>Perl 6? cont.</h4>
                    <p>Try SPI</p> 
                    <p>No module yet but there is <a href="https://www.dexterindustries.com/BrickPi/brickpi3-technical-design-details/brickpi3-communication-protocol/" target="_blank">documentation</a> for interfacing with the BrickPi3.</p>
                </section>

                <section>
                    <img src="images/OpenWest-Hadouken.gif" class="no-border" width="400px">
                    <h4>Travis Chase</h4>
                    <small>Senior Manager of Software Engineering @ Endurance Intl.</small><br>
                    <small><a href="mailto: gaudeon@cpan.org">gaudeon@cpan.org</a></small><br>
                    <small><a href="http://github.com/gaudeon">github.com/gaudeon</a></small>
                </section>
               
			</div>
		</div>

        <div class="credits">
            <div class="credit dragonlance" data-img="images/dragonlance_chronicles_legends.jpg">Photo: Tiago Farrajota | www.flickr.com/photos/nabo | BY-NC-SA-2.0</div>
            <div class="credit ev3visualloop" data-img="images/ev3visualloop.png">Photo: Klaus-Dieter Keller | commons.wikimedia.org/wiki/File:Entfernungsmesser.png | BY-NC-4.0</div>
            <div class="credit ev3brick" data-img="images/ev3brick.png">Photo: Vetalru | commons.wikimedia.org/wiki/File:Lego-mindstorms-ev3.jpg | BY-SA-3.0</div>
            <div class="credit langsev3dev" data-img="images/Programming_Languages_on_ev3dev.png">Captured from www.ev3dev.org/docs/programming-languages</div>
            <div class="credit ev3devcperl" data-img="images/ev3devcperl.png">Captured from github.com/in4lio/ev3dev-c/tree/master/perl</div>
            <div class="credit docker" data-img="images/docker.jpg">Photo: Linux Screenshots | www.flickr.com/photos/xmodulo | BY-2.0</div>
            <div class="credit ev3devcexamples" data-img="images/ev3devcexamples.png">Captured from giithub.com/in4lio/ev3dev-c</div>
            <div class="credit ev3devcperlexamples" data-img="images/ev3devcperlexamples.png">Captured from github.com/in4lio/ev3dev-c/tree/master/perl/eg</div>
            <div class="credit ev3devlangsupporttip" data-img="images/ev3devlangsupporttip.png">Captured from www.ev3dev.org/docs/programming-languages</div>
            <div class="credit lucy" data-img="images/lucy.jpg">Photo: Allentchang | commons.wikimedia.org/wiki/File:Lucy_and_the_psychiatric_help_booth.jpg | BY-SA-3.0</div>
        </div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
                history: true,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
